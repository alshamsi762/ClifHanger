<!-- Set as HTML 5 -->
<!DOCTYPE html>

<!-- HTML Script -->
<html>
<style>
.test {
	height: 40px;
	width: 40px;
}
</style>
	<!-- Head -->
	<head>

		<!-- Tab Title -->
    <title>
			CliffHanger
		</title>

		<!-- Import Bootstrap -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">
    <!-- Put your CSS Stuff Here. -->
	</head>

	<!-- Body -->
	<body class="container-fluid">
		<p id = "game">
      		<!-- Put HTML Stuff Here. -->

    		</p>

		<button id = "strtGameBttn" onclick="startGame()">Start Game</button>
		<button id = "endTurn" onclick="endTurn()">End Turn</button>
		<p id = "gameboard"></p>
		<p id = "instructions"></p>
		<p id = "status"></p>
		<p id = "offensiveItems"></p>
		<p id = "defensiveItems"></p>

		<!-- JS Scripts -->
    <!-- Put your JavaScript Here. -->
		<script src="item.js" type="text/javascript"></script>
		<script src="player.js" type="text/javascript"></script>
		<script src="boardspace.js" type="text/javascript"></script>
		<script src="gameplay.js" type="text/javascript"></script>

		<script>
			let player1 = new Player(0, 100, 0, [], [], "Andrew", 0);
			let player2 = new Player(1, 100, 0, [], [], "Amjad", 0);
			let player3 = new Player(2, 100, 0, [], [], "Sultan", 0);
			let player4 = new Player(3, 100, 0, [], [], "Anirudh", 0);

			var game = null;
			var player = null;

			var tempIDs = ["A", "B", "C", "D"]
			function startGame() {
				document.getElementById("strtGameBttn").disabled = true;

				game = new Gameplay(player1, player2, player3, player4);
				game.createBoard();

				// Create all the buttons (boardspaces)
				for (var i = 0; i < 100; i++) {
					if (i % 10 == 0) {
						document.getElementById("game").innerHTML += "<br />";
					}
					var button = "<button id = \"" + i + "\" class=\"test\" onclick = \"boardspacePressed(\'" + i;
					button += "\')\" disabled>";
					if (game.board[i].hasPlayer()) {
						button += tempIDs[game.board[i].player.id];
					} else if (game.board[i].hasLoot()) {
						button += game.items.indexOf(game.board[i].loot);
					} else {
						button += "&nbsp";
					}

					button += "</button>";
					document.getElementById("game").innerHTML += button;
				}
				// Start player 1's turn
				nextTurn();
			}

			function nextTurn() {
				// Get the next player
				if (player == null) {
					player = game.playerList.head;
				} else if (player.next.data.id == -1){
					game.fullTurnCount++;
					game.shouldShrinkBoard();
					{
						var i = game.dropItem();
						document.getElementById("" + i).innerHTML = game.items.indexOf(game.board[i].loot);
					}
					player = game.playerList.head;
				} else {
					player = player.next;
				}
				// Clear any active buttons
				disableBoard();
				document.getElementById("offensiveItems").innerHTML = "&nbsp";
				document.getElementById("defensiveItems").innerHTML = "&nbsp";

				if (!game.hasEnded()) {
				// Tell the player to start their turn
					document.getElementById("instructions").innerHTML = player.data.name + ", make a move.<br />";
				} else {
					document.getElementById("instructions").innerHTML = player.data.name + " has won!";
					return;
				}
				// Display possible moves
				var possibleMoves = game.possibleMovesFrom(game.board[player.data.position]);
				for (var i = 0; i < possibleMoves.length; i++) {
					document.getElementById(""+possibleMoves[i]).disabled = false;
					document.getElementById(""+possibleMoves[i]).style = "background-color: green";
				}
				game.startTurnFor(player.data);
				displayPlayerInfo();
			}

			function boardspacePressed(boardspace) {
				// This function will handle pressing a boardspace with different player statuses
				if (player.data.status == 1) {	// Moving
					document.getElementById("" + player.data.position).innerHTML = "&nbsp";
					game.moveTo(game.board[parseInt(boardspace)]);
					document.getElementById("" + boardspace).innerHTML =  tempIDs[player.data.id];
					disableBoard();
					if (player.data.status == 2) {	// Player was not trapped
						for (var i = 0; i < game.attackSpaces.length; i++) {
								document.getElementById("" + game.attackSpaces[i]).disabled = false;
								document.getElementById("" + game.attackSpaces[i]).style = "background-color: red";
						}
						displayItems();
						document.getElementById("instructions").innerHTML = player.data.name + ", attack someone near you or end your turn.<br />";
					} else if (player.data.status == 0) {
						endTurn();
					}
				} else if (player.data.status == 2) {	// Attacking or Defending
					if (game.currItem == game.items[12]) { // Teleport item
						document.getElementById("" + player.data.position).innerHTML = "&nbsp";
						game.useItem(game.currItem, game.board[boardspace]);
						document.getElementById("" + player.data.position).innerHTML =  tempIDs[player.data.id];

					} else {
						var origin = player.data.position;
						var dir = "NONE";
						if (origin - boardspace >= 10) {
							dir = "UP";
						} else if (origin - boardspace <= -10) {
							dir = "DOWN";
						} else if (origin - boardspace >= 1 && origin - boardspace < 10) {
							dir = "LEFT";
						} else if (origin - boardspace <= -1 && origin - boardspace > -10) {
							dir = "RIGHT";
						}
						game.useItem(game.currItem, dir);
					}
					disableBoard();
					endTurn();
				}
			}

			function endTurn() {
				game.endTurnFor(player.data);
				disableBoard();
				nextTurn();
			}

			function disableBoard() {
				for (var i = 0; i < 100; i++) {
					document.getElementById("" + i).disabled = true;
					if (game.board[i].fallStage == 1) {
						document.getElementById("" + i).style = "background-color: yellow";
					} else if (game.board[i].fallStage == 2) {
						document.getElementById("" + i).style = "background-color: transparent";
						document.getElementById("" + i).innerHTML = "&nbsp";
					} else {
						document.getElementById("" + i).style = "";
					}
				}
			}

			function displayItems() {
				var offense = "";
				var defense = "";

				for (var i = 0; i < game.currPlayer.offensive.length; i++) {
					offense += "<button onclick=\"itemSelected(\'" + game.items.indexOf(game.currPlayer.offensive[i]) + "\')\">";
					offense += game.currPlayer.offensive[i].name + "</button>";
				}
				for (var i = 0; i < game.currPlayer.defensive.length; i++) {
					defense += "<button onclick=\"itemSelected(\'" + game.items.indexOf(game.currPlayer.defensive[i]) + "\')\">";
					defense += game.currPlayer.defensive[i].name + "</button>";
				}
				document.getElementById("offensiveItems").innerHTML = "Offensive Items:  " + offense;
				document.getElementById("defensiveItems").innerHTML = "Defensive Items:  " + defense;
			}

			function itemSelected(index) {
				var item = game.items[parseInt(index)]
				game.chooseItem(item);
				disableBoard();
				if (item.name == "Teleport" || item.name == "Move Again") {	// Teleport and Move Again show moves
					for (var i = 0; i < game.moveSpaces.length; i++) {
						document.getElementById(""+game.moveSpaces[i]).disabled = false;
						document.getElementById(""+game.moveSpaces[i]).style = "background-color: green";
					}
				} else {	// Other items show attack spaces
					for (var i = 0; i < game.attackSpaces.length; i++) {
						document.getElementById("" + game.attackSpaces[i]).disabled = false;
						document.getElementById("" + game.attackSpaces[i]).style = "background-color: red";
					}
				}
				// Need to redisplay possible attacks or movement
				// if (item.itemType == item.OFFENSE && item.attackType != item.TRAP) {
				// 	// Display attackSpaces
				// 	for (var i = 0; i < game.attackSpaces.length; i++) {
				// 		document.getElementById("" + game.attackSpaces[i]).disabled = false;
				// 		document.getElementById("" + game.attackSpaces[i]).style = "background-color: red";
				// 	}
				// } else if (item.itemType == item.DEFENSE) {
				// 	if (item.name == "Minor Potion") {
				// 		// Heal 10
				// 		game.useItem(item);
				// 	} else if (item.name == "Major Potion") {
				// 		// Heal 30
				// 		game.useItem(item);
				// 	}	else if (item.name == "Teleport") {
				// 		// Teleport
				// 	  // var possibleMoves = game.possibleMovesFrom(game.board[game.currPlayer.position]);
				// 		for (var i = 0; i < game.moveSpaces.length; i++) {
				// 			document.getElementById(""+game.moveSpaces[i]).disabled = false;
				// 			document.getElementById(""+game.moveSpaces[i]).style = "background-color: green";
				// 		}
				// 	} else if (item.name == "Move Again") {
				// 		// Move again.
				// 	}
				// }
			}

			function displayPlayerInfo() {
				var pInfo = "";
				pInfo += "Health:&nbsp\t&nbsp[";
				for (var i = 0; i < 10; i++) {
					if (game.currPlayer.getHealth() / 10 >= i) {
						pInfo += "=";
					} else {
						pInfo += "&nbsp";
					}
				}
				pInfo += "]";
				pInfo += game.currPlayer.getHealth();
				document.getElementById("status").innerHTML = pInfo;
			}

		</script>
		<script src="http://threejs.org/build/three.min.js"></script>

	</body>
</html>
